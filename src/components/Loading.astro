---
// Loading optimizer component for faster page transitions
---

<script>
  // Optimize page transitions with loading states (solo funciones)
  let loadingTimeout: NodeJS.Timeout | undefined;

  function showLoadingIndicator() {
    const indicator = document.createElement('div');
    indicator.id = 'page-loading-indicator';
    indicator.innerHTML = `
      <div style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, #f59e0b, #d97706);
        z-index: 9999;
        animation: loading-bar 1s ease-in-out infinite;
      "></div>
    `;
    const style = document.createElement('style');
    style.textContent = `
      @keyframes loading-bar {
        0% { transform: translateX(-100%); }
        50% { transform: translateX(0%); }
        100% { transform: translateX(100%); }
      }
    `;
    document.head.appendChild(style);
    document.body.appendChild(indicator);
  }

  function hideLoadingIndicator() {
    const indicator = document.getElementById('page-loading-indicator');
    if (indicator) indicator.remove();
  }

  function optimizeMenuPage() {
    // Preload critical menu resources
    const criticalImages = [
      '/img/placeholder-image.webp',
      '/assets/images/chicken-banner.webp'
    ];
    criticalImages.forEach(src => {
      const link = document.createElement('link');
      link.rel = 'preload';
      link.as = 'image';
      link.href = src;
      document.head.appendChild(link);
    });
    optimizeComponentHydration();
  }

  function optimizeComponentHydration() {
    const criticalComponents = document.querySelectorAll('[data-astro-cid]');
    criticalComponents.forEach(component => {
      if (component.hasAttribute('client:idle') || component.hasAttribute('client:visible')) {
        setupIntersectionObserver(component);
      }
    });
  }

  function setupIntersectionObserver(element: Element) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('component-visible');
          observer.unobserve(entry.target);
        }
      });
    }, {
      rootMargin: '50px'
    });
    observer.observe(element);
  }

  // Setup transition optimization
  function setupTransitionOptimization() {
    document.addEventListener('astro:before-preparation', () => {
      loadingTimeout = setTimeout(() => {
        showLoadingIndicator();
      }, 200);
    });
    document.addEventListener('astro:after-preparation', () => {
      clearTimeout(loadingTimeout);
      hideLoadingIndicator();
    });
    document.addEventListener('astro:page-load', () => {
      if (window.location.pathname.includes('/menu')) {
        optimizeMenuPage();
      }
    });
  }

  setupTransitionOptimization();
</script>

<style>
  /* Optimize component loading states */
  [data-astro-cid]:not(.component-visible) {
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  [data-astro-cid].component-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Optimize menu page specific elements */
  .menu-container {
    contain: layout style paint;
  }

  .menu-item {
    contain: layout style;
  }
</style>